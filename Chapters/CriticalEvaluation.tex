%Chapter of Critical Evaluation
%What is maybe not so great about it
\chapter{Critical Evaluation}
\label{crit}



The XAMPP server, the PHP files and the JSP application that displays the temperature data are accessible through a browser by anyone on the network. To protect against this it is possible to set up passwords for the server and database to restrict access to the files. Realms or IP filtering could be set up to restrict users from accessing the update server secret key and nonce page. A realm is a database of usernames and passwords that identify valid users of a web app and can be used to provided levels of access.

The way the Arduino accesses the new server public key at the moment is simply by sending a GET request to the server for it. But an attacker could easily send the same get request and get a public key and the encrypted nonce because the nonce is encrypted the attacker wouldn't be able to send a valid message to the server without also having the keys but it would cause the Arduino and server to be out of sync, they would both be using a different set of keys and nonces and no more temperature data could be sent without a server and Arduino restart.

The preinstalled initial public and private key of the server and the public key of the arduino and the signature keys are stored as plaintext in the web application and it might be possible to read them from the WAR files. If the attacker is fast and captures the initial messages and has the keys from the WAR file then the resulting messages will be compromised. Although, if the attacker has access to the files on the server then there has already been a much larger security breach.

The Arduino doesn't have access to /dev/random and can't provide good enough random data to make good key pairs. Which means that it can't update it's own secret key, for example if the key has been compromised or it is part of a regular renewal service to key security tight.

When the public keys are transmitted for the first time, it is best to have a human user to manually inspect the keys and ensure they are the same before they can be used for data transmission. 

The PHP files that the Arduino Due sends a POST request to do not authenticate the requests and as such anyone who knows the IP address of the server could send data into the SQL database. However when the Java web app retrieves the data out of the database if it is not encrypted or was encrypted with the wrong keys or nonce then the decryption will fail and the data won't be displayed to the user.

The JSP page that sends a new public key and encrypted nonce to the Arduino Due does not have any restrictions on it's access. Therefore if a malicious connection is made to the server then that connection will receive the data. This public key and nonce could then be used by the attacker to add in their own data or to simply interfere with the normal operation of the application. This could be solved in a similar manner to securing the PHP files with IP filtering or setting up a realm.

If the new public key and encrypted nonce do not make it to the Arduino or the encrypted temperature message doesn't make it, then the key and nonce synchronisation between the server and Arduino is lost. This could be solved with acknowledgements whereby the server and Arduino send a small message at the end of a communication to let each other know that they have indeed received the information.

This prototype has used the Ethernet Shield as it was much cheaper than a WiFi shield. If an implementation similar to the one described in this report was to be implemented then it would be convenient for the user to provide connection over WiFi. The product also risks not being adopted as more and more products have wireless capabilities and users see it as the norm and resent cables. This will be especially important if the device uses batteries to power itself.

If the server is shut down for any reason during normal operation the keys and nonces used to decrypt the data stored in the SQL database would be lost forever. A way is needed to securely write the keys and nonces to disk.